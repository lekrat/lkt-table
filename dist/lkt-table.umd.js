(function(m,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("vuedraggable"),require("lkt-tools"),require("vue")):typeof define=="function"&&define.amd?define(["exports","vuedraggable","lkt-tools","vue"],f):(m=typeof globalThis<"u"?globalThis:m||self,f(m.LktTable={},m.draggable,m.LktTools,m.Vue))})(this,function(m,f,r,t){"use strict";const y=(e=>e&&typeof e=="object"&&"default"in e?e:{default:e})(f);class p{constructor(n="",l=""){this.key=n,this.label=l,this.sortable=!0,this.hidden=!1,this.formatter=void 0,this.checkEmpty=void 0,this.colspan=void 0}setIsSortable(n=!0){return this.sortable=n,this}setIsHidden(n=!0){return this.hidden=n,this}setFormatter(n=void 0){return this.formatter=n,this}setEmptyChecker(n=void 0){return this.checkEmpty=n,this}setColSpan(n=void 0){return this.colspan=void 0,this}}const B=(e,n)=>new p(e,n),S=(e,n,l,o)=>{if(!l)return 0;let d=e[l.key],s=n[l.key];if(o==="asc"){if(d>s)return 1;if(s>d)return-1}else{if(d>s)return-1;if(s>d)return 1}return 0},E=(e,n,l)=>r.isFunction(e.formatter)?e.formatter(n[e.key],n,e,l):n[e.key],C=(e,n,l)=>{if(!e.colspan)return-1;let o=n;return l.forEach(d=>{let s=u(e,d);s>0&&s<o&&(o=s)}),o},u=(e,n)=>e.colspan===!1?!1:r.isFunction(e.colspan)?e.colspan(n):e.colspan,V=(e,n,l)=>{if(!r.isObject(e)||!e.key||n.indexOf(e.key)>-1)return!1;let o=u(e,l);return r.isUndefined(e.colspan)?!0:(r.isUndefined(e.colspan)||(r.isFunction(e.colspan)?o=parseInt(e.colspan()):o=parseInt(e.colspan)),o>0)},D=(e=[])=>{if(e.length>0){for(let n=0;n<e.length;++n)if(e[n].sortable===!0)return e[n].key}return""},N={name:"LktTableRow",emits:["click","show"],props:{isDraggable:{type:Boolean,default:!0},i:{type:[Number],default:0},hiddenColumnsColSpan:{type:Number,default:0},visibleColumns:{type:Array,default:()=>[]},hiddenColumns:{type:Array,default:()=>[]},emptyColumns:{type:Array,default:()=>[]},hiddenIsVisible:{type:Boolean,default:!1},item:{type:Object,default:()=>({})}},methods:{canRenderColumn:V,getColumnDisplayContent:E,getVerticalColSpan:C,getHorizontalColSpan:u}},b=(e,n)=>{const l=e.__vccOpts||e;for(const[o,d]of n)l[o]=d;return l},I=["data-i","data-handle-drag"],L={key:0,"data-role":"drag-indicator"},w={key:1,"data-role":"invalid-drag-indicator"},F=["data-column","colspan","title","onClick"],H={key:0,"data-role":"hidden-row"},R=["colspan"],U=["data-column"],A=["data-i"],O=["data-column","title","onClick"];function j(e,n,l,o,d,s){return t.openBlock(),t.createElementBlock(t.Fragment,null,[t.createElementVNode("tr",{"data-i":l.i,"data-handle-drag":l.isDraggable},[l.isDraggable?(t.openBlock(),t.createElementBlock("td",L)):(t.openBlock(),t.createElementBlock("td",w)),l.hiddenColumns.length>0?(t.openBlock(),t.createElementBlock("td",{key:2,onClick:n[0]||(n[0]=a=>e.$emit("show",{$event:a,i:l.i})),"data-role":"show-more",class:t.normalizeClass(l.hiddenIsVisible?"state-open":"")},null,2)):t.createCommentVNode("",!0),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(l.visibleColumns,a=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[s.canRenderColumn(a,l.emptyColumns,l.item)?(t.openBlock(),t.createElementBlock("td",{key:0,"data-column":a.key,colspan:s.getHorizontalColSpan(a,l.item),title:s.getColumnDisplayContent(a,l.item,l.i),onClick:h=>e.$emit("click",{$event:h,item:l.item,column:a})},[e.$slots[a.key]?t.renderSlot(e.$slots,a.key,{key:0,value:l.item[a.key],item:l.item,column:a,i:l.i}):l.item?(t.openBlock(),t.createElementBlock(t.Fragment,{key:1},[t.createTextVNode(t.toDisplayString(s.getColumnDisplayContent(a,l.item,l.i)),1)],64)):t.createCommentVNode("",!0)],8,F)):t.createCommentVNode("",!0)],64))),256))],8,I),l.hiddenColumns.length>0?t.withDirectives((t.openBlock(),t.createElementBlock("tr",H,[t.createElementVNode("td",{colspan:l.hiddenColumnsColSpan},[t.createElementVNode("table",null,[t.createElementVNode("tr",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(l.hiddenColumns,a=>(t.openBlock(),t.createElementBlock("th",{"data-column":a.key},[t.createElementVNode("div",null,t.toDisplayString(a.label),1)],8,U))),256))]),t.createElementVNode("tr",{"data-i":l.i},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(l.hiddenColumns,(a,h)=>(t.openBlock(),t.createElementBlock("td",{"data-column":a.key,title:s.getColumnDisplayContent(a,l.item,h),onClick:i=>e.$emit("click",{$event:i,item:l.item,column:a})},[e.$slots[a.key]?t.renderSlot(e.$slots,a.key,{key:0,value:l.item[a.key],item:l.item,column:a,i:h}):(t.openBlock(),t.createElementBlock(t.Fragment,{key:1},[t.createTextVNode(t.toDisplayString(s.getColumnDisplayContent(a,l.item,h)),1)],64))],8,O))),256))],8,A)])],8,R)],512)),[[t.vShow,l.hiddenIsVisible]]):t.createCommentVNode("",!0)],64)}const q=b(N,[["render",j]]),z=t.defineComponent({name:"LktTable",components:{LktTableRow:q,draggable:y.default},props:{value:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},sorter:{type:Function},sortable:{type:Boolean,default:!1},hideEmptyColumns:{type:Boolean,default:!1},draggableChecker:{type:Function,default:e=>!0},checkValidDrag:{type:Function,default:e=>!0},draggableItemKey:{type:String,default:"name"}},emits:["input","sort","click"],data(){return{Sorter:r.isFunction(this.sorter)?this.sorter:S,SortBy:D(this.columns),SortDirection:"asc",Items:this.value,Hidden:{},drag:!1,dragGroup:r.generateRandomString(16),uniqueId:r.generateRandomString(12)}},computed:{slots(){return r.getSlots(this.$slots)},hasData(){return this.Items.length>0},emptyColumns(){if(!this.hideEmptyColumns)return[];let e=[];return this.columns.forEach(n=>{let l=n.key,o=!1;this.Items.forEach(d=>{if(r.isFunction(d.checkEmpty))return d.checkEmpty(d);d[l]&&(o=!0)}),o||e.push(l)}),e},visibleColumns(){return this.columns.filter(e=>e.hidden!==!0)},hiddenColumns(){return this.columns.filter(e=>e.hidden===!0)},hiddenColumnsColSpan(){let e=this.visibleColumns.length+1;return this.sortable&&++e,e}},watch:{value:{handler(e){this.Items=e},deep:!0},Items:{handler(e){this.$emit("input",e)},deep:!0}},methods:{getVerticalColSpan:C,getHorizontalColSpan:u,getItemByEvent(e){let n=e.target;if(r.isUndefined(n.dataset.column))do n=n.parentNode;while(r.isUndefined(n.dataset.column)&&n.tagName!=="TABLE"&&n.tagName!=="body");if(n.tagName==="TD"&&(n=n.parentNode,n=n.dataset.i,!r.isUndefined(n)))return this.Items[n]},isVisible(e){return this.Hidden["tr_"+e]===!0},sort(e){e.sortable===!0&&(this.Items=this.Items.sort((n,l)=>this.Sorter(n,l,e,this.SortDirection)),this.SortDirection=this.SortDirection==="asc"?"desc":"asc",this.SortBy=e.key,this.$emit("sort",[this.SortBy,this.SortDirection]))},onClick(e){this.$emit("click",e)},show(e){let n="tr_"+e.i;this.Hidden[n]=r.isUndefined(this.Hidden[n])?!0:!this.Hidden[n]}}}),G=["data-sortable"],K={key:0,"data-role":"drag-indicator"},M={key:1},T=["data-column","data-sortable","data-sort","colspan","title","onClick"],P={key:1},J={key:1,"data-lkt":"empty-table"};function Q(e,n,l,o,d,s){const a=t.resolveComponent("LktTableRow"),h=t.resolveComponent("draggable");return t.openBlock(),t.createElementBlock("div",null,[e.hasData?(t.openBlock(),t.createElementBlock("div",{key:0,"data-lkt":"table","data-sortable":e.sortable},[t.createElementVNode("table",null,[t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[e.sortable?(t.openBlock(),t.createElementBlock("th",K)):t.createCommentVNode("",!0),e.hiddenColumns.length>0?(t.openBlock(),t.createElementBlock("th",M)):t.createCommentVNode("",!0),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.visibleColumns,i=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[e.emptyColumns.indexOf(i.key)===-1?(t.openBlock(),t.createElementBlock("th",{key:0,"data-column":i.key,"data-sortable":i.sortable===!0,"data-sort":i.sortable===!0&&e.SortBy===i.key?e.SortDirection:"",colspan:e.getVerticalColSpan(i,e.columns.length,e.Items),title:i.label,onClick:c=>e.sort(i)},[t.createElementVNode("div",null,t.toDisplayString(i.label),1)],8,T)):t.createCommentVNode("",!0)],64))),256))])]),e.sortable?(t.openBlock(),t.createBlock(h,{key:0,modelValue:e.Items,"onUpdate:modelValue":n[0]||(n[0]=i=>e.Items=i),group:e.dragGroup,move:e.checkValidDrag,"item-key":e.draggableItemKey,onStart:n[1]||(n[1]=i=>e.drag=!0),onEnd:n[2]||(n[2]=i=>e.drag=!1),tag:"tbody","data-lkt":"sortable-table",handle:"[data-handle-drag]"},{item:t.withCtx(({element:i,index:c})=>[(t.openBlock(),t.createBlock(a,{key:e.uniqueId+"-"+c,i:c,item:i,"hidden-columns":e.hiddenColumns,"hidden-columns-col-span":e.hiddenColumnsColSpan,"is-draggable":e.draggableChecker?e.draggableChecker(i):!0,"visible-columns":e.visibleColumns,"empty-columns":e.emptyColumns,"hidden-is-visible":e.isVisible(c),onClick:e.onClick,onShow:e.show},t.createSlots({_:2},[t.renderList(e.slots,(Y,g)=>({name:g,fn:t.withCtx(k=>[t.renderSlot(e.$slots,g,{item:k.item,value:k.value,column:k.column})])}))]),1032,["i","item","hidden-columns","hidden-columns-col-span","is-draggable","visible-columns","empty-columns","hidden-is-visible","onClick","onShow"]))]),_:3},8,["modelValue","group","move","item-key"])):(t.openBlock(),t.createElementBlock("tbody",P,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.Items,(i,c)=>(t.openBlock(),t.createBlock(a,{key:e.uniqueId+"-"+c,i:c,item:i,"hidden-columns":e.hiddenColumns,"hidden-columns-col-span":e.hiddenColumnsColSpan,"is-draggable":e.draggableChecker?e.draggableChecker(i):!0,"visible-columns":e.visibleColumns,"empty-columns":e.emptyColumns,"hidden-is-visible":e.isVisible(c),onClick:e.onClick,onShow:e.show},t.createSlots({_:2},[t.renderList(e.slots,(Y,g)=>({name:g,fn:t.withCtx(k=>[t.renderSlot(e.$slots,g,{item:k.item,value:k.value,column:k.column})])}))]),1032,["i","item","hidden-columns","hidden-columns-col-span","is-draggable","visible-columns","empty-columns","hidden-is-visible","onClick","onShow"]))),128))]))])],8,G)):e.$slots["no-items"]?(t.openBlock(),t.createElementBlock("div",J,[t.renderSlot(e.$slots,"no-items")])):t.createCommentVNode("",!0)])}const W=b(z,[["render",Q]]),X={install:(e,n)=>{e.component("LktTable",W);let l=!0;r.isObject(n)&&!r.isUndefined(n.mountDraggableComponent)&&n.mountDraggableComponent===!1&&(l=!1),l&&e.component("draggable",y.default)}};m.createColumn=B,m.default=X,Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
