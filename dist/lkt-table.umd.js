(function(i,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("vuedraggable"),require("lkt-events"),require("vue"),require("lkt-string-tools"),require("lkt-vue-tools")):typeof define=="function"&&define.amd?define(["exports","vuedraggable","lkt-events","vue","lkt-string-tools","lkt-vue-tools"],d):(i=typeof globalThis<"u"?globalThis:i||self,d(i.LktTable={},i.draggable,i.LktEvents,i.Vue,i.LktStringTools,i.LktVueTools))})(this,function(i,d,h,t,B,I){"use strict";var le=Object.defineProperty;var re=(i,d,h)=>d in i?le(i,d,{enumerable:!0,configurable:!0,writable:!0,value:h}):i[d]=h;var y=(i,d,h)=>(re(i,typeof d!="symbol"?d+"":d,h),h);const w=(e=>e&&typeof e=="object"&&"default"in e?e:{default:e})(d);class S{constructor(o="",n=""){y(this,"key");y(this,"label");y(this,"sortable");y(this,"hidden");y(this,"formatter");y(this,"checkEmpty");y(this,"colspan");this.key=o,this.label=n,this.sortable=!0,this.hidden=!1,this.formatter=void 0,this.checkEmpty=void 0,this.colspan=void 0}setIsSortable(o=!0){return this.sortable=o,this}setIsHidden(o=!0){return this.hidden=o,this}setFormatter(o=void 0){return this.formatter=o,this}setEmptyChecker(o=void 0){return this.checkEmpty=o,this}setColSpan(o=void 0){return this.colspan=void 0,this}}const D=(e,o,n=!0)=>new S(e,o).setIsSortable(n),N=(e,o,n=!0)=>new S(e,o).setIsSortable(n).setIsHidden(!0),L=(e,o,n,a)=>{if(!n)return 0;let s=e[n.key],p=o[n.key];if(a==="asc"){if(s>p)return 1;if(p>s)return-1}else{if(s>p)return-1;if(p>s)return 1}return 0},E=(e,o,n)=>e.formatter&&typeof e.formatter=="function"?e.formatter(o[e.key],o,e,n):o[e.key],b=(e,o,n)=>{if(!e.colspan)return-1;let a=o;return n.forEach(s=>{let p=f(e,s);p>0&&p<a&&(a=p)}),a},f=(e,o)=>e.colspan===!1?!1:typeof e.colspan=="function"?e.colspan(o):e.colspan,$=(e,o,n)=>{if(typeof e!="object"||!e.key||o.indexOf(e.key)>-1)return!1;let a=f(e,n);return typeof e.colspan>"u"?!0:(typeof e.colspan<"u"&&(typeof e.colspan=="function"?a=parseInt(e.colspan()):a=parseInt(e.colspan)),a>0)},H=(e=[])=>{if(e.length>0){for(let o=0;o<e.length;++o)if(e[o].sortable)return e[o].key}return""},T=(e,o)=>{if(e.length>0){for(let n=0;n<e.length;++n)if(e[n].key===o)return e[n]}return null},F=t.defineComponent({name:"LktTableRow",emits:["click","show"],props:{isDraggable:{type:Boolean,default:!0},sortable:{type:Boolean,default:!0},i:{type:[Number],default:0},displayHiddenColumnsIndicator:{type:Boolean,default:!1},visibleColumns:{type:Array,default:()=>[]},emptyColumns:{type:Array,default:()=>[]},hiddenIsVisible:{type:Boolean,default:!1},item:{type:Object,default:()=>({})}},methods:{canRenderColumn:$,getColumnDisplayContent:E,getVerticalColSpan:b,getHorizontalColSpan:f,onClick(e,o,n){this.$emit("click",e,h.createLktEvent("",{item:o,column:n}))},onShow(e,o){this.$emit("show",e,h.createLktEvent("",{i:o}))}}}),C=(e,o)=>{const n=e.__vccOpts||e;for(const[a,s]of o)n[a]=s;return n},q=["data-i","data-handle-drag"],A={key:0,"data-role":"drag-indicator"},R={key:1,"data-role":"invalid-drag-indicator"},j=["data-column","colspan","title","onClick"];function O(e,o,n,a,s,p){return t.openBlock(),t.createElementBlock("tr",{"data-i":e.i,"data-handle-drag":e.isDraggable},[e.sortable&&e.isDraggable?(t.openBlock(),t.createElementBlock("td",A)):e.sortable?(t.openBlock(),t.createElementBlock("td",R)):t.createCommentVNode("",!0),e.displayHiddenColumnsIndicator?(t.openBlock(),t.createElementBlock("td",{key:2,onClick:o[0]||(o[0]=l=>e.onShow(l,e.i)),"data-role":"show-more",class:t.normalizeClass(e.hiddenIsVisible?"state-open":"")},null,2)):t.createCommentVNode("",!0),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.visibleColumns,l=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[e.canRenderColumn(l,e.emptyColumns,e.item)?(t.openBlock(),t.createElementBlock("td",{key:0,"data-column":l.key,colspan:e.getHorizontalColSpan(l,e.item),title:e.getColumnDisplayContent(l,e.item,e.i),onClick:u=>e.onClick(u,e.item,l)},[e.$slots[l.key]?t.renderSlot(e.$slots,l.key,{key:0,value:e.item[l.key],item:e.item,column:l,i:e.i}):e.item?(t.openBlock(),t.createElementBlock(t.Fragment,{key:1},[t.createTextVNode(t.toDisplayString(e.getColumnDisplayContent(l,e.item,e.i)),1)],64)):t.createCommentVNode("",!0)],8,j)):t.createCommentVNode("",!0)],64))),256))],8,q)}const K=C(F,[["render",O]]),z=t.defineComponent({name:"LktHiddenRow",emits:["click","show"],props:{isDraggable:{type:Boolean,default:!0},sortable:{type:Boolean,default:!0},i:{type:[Number],default:0},hiddenColumnsColSpan:{type:Number,default:0},visibleColumns:{type:Array,default:()=>[]},hiddenColumns:{type:Array,default:()=>[]},emptyColumns:{type:Array,default:()=>[]},hiddenIsVisible:{type:Boolean,default:!1},item:{type:Object,default:()=>({})}},methods:{canRenderColumn:$,getColumnDisplayContent:E,getVerticalColSpan:b,getHorizontalColSpan:f,onClick(e,o,n){this.$emit("click",e,h.createLktEvent("",{item:o,column:n}))},onShow(e,o){this.$emit("show",e,h.createLktEvent("",{i:o}))}}}),M={"data-role":"hidden-row"},G=["colspan"],P=["data-column"],U=["data-i"],J=["data-column","title","onClick"];function Q(e,o,n,a,s,p){return t.withDirectives((t.openBlock(),t.createElementBlock("tr",M,[t.createElementVNode("td",{colspan:e.hiddenColumnsColSpan},[t.createElementVNode("table",null,[t.createElementVNode("tr",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.hiddenColumns,l=>(t.openBlock(),t.createElementBlock("th",{"data-column":l.key},[t.createElementVNode("div",null,t.toDisplayString(l.label),1)],8,P))),256))]),t.createElementVNode("tr",{"data-i":e.i},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.hiddenColumns,(l,u)=>(t.openBlock(),t.createElementBlock("td",{"data-column":l.key,title:e.getColumnDisplayContent(l,e.item,u),onClick:g=>e.onClick(g,e.item,l)},[e.$slots[l.key]?t.renderSlot(e.$slots,l.key,{key:0,value:e.item[l.key],item:e.item,column:l,i:u}):(t.openBlock(),t.createElementBlock(t.Fragment,{key:1},[t.createTextVNode(t.toDisplayString(e.getColumnDisplayContent(l,e.item,u)),1)],64))],8,J))),256))],8,U)])],8,G)],512)),[[t.vShow,e.hiddenIsVisible]])}const W=C(z,[["render",Q]]),X=t.defineComponent({name:"LktTable",components:{LktHiddenRow:W,LktTableRow:K,draggable:w.default},props:{modelValue:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},sorter:{type:Function},sortable:{type:Boolean,default:!1},hideEmptyColumns:{type:Boolean,default:!1},draggableChecker:{type:Function,default:e=>!0},checkValidDrag:{type:Function,default:e=>!0},draggableItemKey:{type:String,default:"name"}},emits:["update:modelValue","sort","click"],data(){return{Sorter:typeof this.sorter=="function"?this.sorter:L,SortBy:H(this.columns),SortDirection:"asc",Items:this.modelValue,Hidden:{},drag:!1,dragGroup:B.generateRandomString(16),uniqueId:B.generateRandomString(12)}},computed:{slots(){return I.getSlots(this.$slots)},hasData(){return this.Items.length>0},emptyColumns(){if(!this.hideEmptyColumns)return[];let e=[];return this.columns.forEach(o=>{let n=o.key,a=!1;this.Items.forEach(s=>{if(typeof s.checkEmpty=="function")return s.checkEmpty(s);s[n]&&(a=!0)}),a||e.push(n)}),e},visibleColumns(){return this.columns.filter(e=>e.hidden!==!0)},hiddenColumns(){return this.columns.filter(e=>e.hidden===!0)},hiddenColumnsColSpan(){let e=this.visibleColumns.length+1;return this.sortable&&++e,e},displayHiddenColumnsIndicator(){return this.hiddenColumns.length>0&&!this.sortable}},watch:{modelValue:{handler(e){this.Items=e},deep:!0},Items:{handler(e){this.$emit("update:modelValue",e)},deep:!0}},methods:{getVerticalColSpan:b,getHorizontalColSpan:f,getItemByEvent(e){let o=e.target;if(typeof o.dataset.column>"u")do o=o.parentNode;while(typeof o.dataset.column>"u"&&o.tagName!=="TABLE"&&o.tagName!=="body");if(o.tagName==="TD"&&(o=o.parentNode,o=o.dataset.i,typeof o<"u"))return this.Items[o]},isVisible(e){return this.Hidden["tr_"+e]===!0},sort(e){!e||e.sortable===!0&&(this.Items=this.Items.sort((o,n)=>this.Sorter(o,n,e,this.SortDirection)),this.SortDirection=this.SortDirection==="asc"?"desc":"asc",this.SortBy=e.key,this.$emit("sort",[this.SortBy,this.SortDirection]))},onClick(e,o){this.$emit("click",e,o)},show(e,o){let n="tr_"+o.value.i;this.Hidden[n]=typeof this.Hidden[n]>"u"?!0:!this.Hidden[n]}},mounted(){this.sort(T(this.columns,this.SortBy))}}),Y=["data-sortable"],Z={key:0,"data-role":"drag-indicator"},_={key:1},v=["data-column","data-sortable","data-sort","colspan","title","onClick"],x={key:1},ee={key:1,"data-lkt":"empty-table"};function te(e,o,n,a,s,p){const l=t.resolveComponent("lkt-table-row"),u=t.resolveComponent("draggable"),g=t.resolveComponent("lkt-hidden-row");return t.openBlock(),t.createElementBlock("div",null,[e.hasData?(t.openBlock(),t.createElementBlock("div",{key:0,"data-lkt":"table","data-sortable":e.sortable},[t.createElementVNode("table",null,[t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[e.sortable?(t.openBlock(),t.createElementBlock("th",Z)):t.createCommentVNode("",!0),e.displayHiddenColumnsIndicator?(t.openBlock(),t.createElementBlock("th",_)):t.createCommentVNode("",!0),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.visibleColumns,r=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[e.emptyColumns.indexOf(r.key)===-1?(t.openBlock(),t.createElementBlock("th",{key:0,"data-column":r.key,"data-sortable":r.sortable===!0,"data-sort":r.sortable===!0&&e.SortBy===r.key?e.SortDirection:"",colspan:e.getVerticalColSpan(r,e.columns.length,e.Items),title:r.label,onClick:m=>e.sort(r)},[t.createElementVNode("div",null,t.toDisplayString(r.label),1)],8,v)):t.createCommentVNode("",!0)],64))),256))])]),e.sortable?(t.openBlock(),t.createBlock(u,{key:0,modelValue:e.Items,"onUpdate:modelValue":o[0]||(o[0]=r=>e.Items=r),move:e.checkValidDrag,itemKey:e.draggableItemKey,onStart:o[1]||(o[1]=r=>e.drag=!0),onEnd:o[2]||(o[2]=r=>e.drag=!1),tag:"tbody","data-lkt":"sortable-table",handle:"[data-handle-drag]"},{item:t.withCtx(({element:r,index:m})=>[(t.openBlock(),t.createBlock(l,{key:e.uniqueId+"-"+m,i:m,item:r,"display-hidden-columns-indicator":e.displayHiddenColumnsIndicator,"is-draggable":e.draggableChecker?e.draggableChecker(r):!0,sortable:e.sortable,"visible-columns":e.visibleColumns,"empty-columns":e.emptyColumns,"hidden-is-visible":e.isVisible(m),onClick:e.onClick,onShow:e.show},t.createSlots({_:2},[t.renderList(e.slots,(V,k)=>({name:k,fn:t.withCtx(c=>[t.renderSlot(e.$slots,k,{item:c.item,value:c.value,column:c.column})])}))]),1032,["i","item","display-hidden-columns-indicator","is-draggable","sortable","visible-columns","empty-columns","hidden-is-visible","onClick","onShow"]))]),_:3},8,["modelValue","move","itemKey"])):(t.openBlock(),t.createElementBlock("tbody",x,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.Items,(r,m)=>(t.openBlock(),t.createBlock(l,{key:e.uniqueId+"-"+m,i:m,item:r,"display-hidden-columns-indicator":e.displayHiddenColumnsIndicator,"is-draggable":e.draggableChecker?e.draggableChecker(r):!0,sortable:e.sortable,"visible-columns":e.visibleColumns,"empty-columns":e.emptyColumns,"hidden-is-visible":e.isVisible(m),onClick:e.onClick,onShow:e.show},t.createSlots({_:2},[t.renderList(e.slots,(V,k)=>({name:k,fn:t.withCtx(c=>[t.renderSlot(e.$slots,k,{item:c.item,value:c.value,column:c.column})])}))]),1032,["i","item","display-hidden-columns-indicator","is-draggable","sortable","visible-columns","empty-columns","hidden-is-visible","onClick","onShow"]))),128)),e.hiddenColumns.length>0?(t.openBlock(!0),t.createElementBlock(t.Fragment,{key:0},t.renderList(e.Items,(r,m)=>(t.openBlock(),t.createBlock(g,{key:e.uniqueId+"-"+m,i:m,item:r,"hidden-columns":e.hiddenColumns,"hidden-columns-col-span":e.hiddenColumnsColSpan,"is-draggable":e.draggableChecker?e.draggableChecker(r):!0,sortable:e.sortable,"visible-columns":e.visibleColumns,"empty-columns":e.emptyColumns,"hidden-is-visible":e.isVisible(m),onClick:e.onClick,onShow:e.show},t.createSlots({_:2},[t.renderList(e.slots,(V,k)=>({name:k,fn:t.withCtx(c=>[t.renderSlot(e.$slots,k,{item:c.item,value:c.value,column:c.column})])}))]),1032,["i","item","hidden-columns","hidden-columns-col-span","is-draggable","sortable","visible-columns","empty-columns","hidden-is-visible","onClick","onShow"]))),128)):t.createCommentVNode("",!0)]))])],8,Y)):e.$slots["no-items"]?(t.openBlock(),t.createElementBlock("div",ee,[t.renderSlot(e.$slots,"no-items")])):t.createCommentVNode("",!0)])}const oe=C(X,[["render",te]]),ne={install:e=>{e.component("lkt-table",oe)}};i.createColumn=D,i.createHiddenColumn=N,i.default=ne,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
