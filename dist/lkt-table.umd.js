(function(u,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("vuedraggable"),require("lkt-events"),require("lkt-string-tools")):typeof define=="function"&&define.amd?define(["exports","vue","vuedraggable","lkt-events","lkt-string-tools"],e):(u=typeof globalThis<"u"?globalThis:u||self,e(u.LktTable={},u.Vue,u.draggable,u.LktEvents,u.LktStringTools))})(this,function(u,e,S,$,R){"use strict";var $e=Object.defineProperty;var Le=(u,e,S)=>e in u?$e(u,e,{enumerable:!0,configurable:!0,writable:!0,value:S}):u[e]=S;var C=(u,e,S)=>(Le(u,typeof e!="symbol"?e+"":e,S),S);const M=(t=>t&&typeof t=="object"&&"default"in t?t:{default:t})(S);class B{constructor(l="",n=""){C(this,"key");C(this,"label");C(this,"sortable");C(this,"hidden");C(this,"editable");C(this,"formatter");C(this,"checkEmpty");C(this,"colspan");C(this,"type");C(this,"link");C(this,"action");C(this,"options");this.key=l,this.label=n,this.sortable=!0,this.hidden=!1,this.formatter=void 0,this.checkEmpty=void 0,this.colspan=void 0}setIsSortable(l=!0){return this.sortable=l,this}setIsEditable(l=!0){return this.editable=l,this}setIsHidden(l=!0){return this.hidden=l,this}setFormatter(l=void 0){return this.formatter=l,this}setEmptyChecker(l=void 0){return this.checkEmpty=l,this}setColSpan(l=void 0){return this.colspan=void 0,this}getHref(l){return typeof this.link=="function"?this.link(l):this.link}doAction(l){if(typeof this.action=="function")return this.action(l);console.warn("No action defined")}defineAsLink(l){return this.type="link",this.link=l,this}defineAsText(){return this.type="text",this}defineAsEmail(){return this.type="email",this}defineAsTel(){return this.type="tel",this}defineAsInt(){return this.type="int",this}defineAsFloat(){return this.type="float",this}defineAsCheck(){return this.type="check",this}defineAsSwitch(){return this.type="switch",this}defineAsAction(l){return this.type="action",this.action=l,this}defineAsSelect(l){return this.type="select",this.options=l,this}}const z=(t,l,n=!0)=>new B(t,l).setIsSortable(n),J=(t,l,n,s=!0)=>new B(t,l).setIsSortable(s).defineAsLink(n),P=(t,l,n,s=!0)=>new B(t,l).setIsSortable(s).defineAsAction(n),G=(t,l,n=!0)=>new B(t,l).setIsSortable(n).defineAsText(),Q=(t,l,n=!0)=>new B(t,l).setIsSortable(n).defineAsEmail(),W=(t,l,n=!0)=>new B(t,l).setIsSortable(n).defineAsTel(),X=(t,l,n=!0)=>new B(t,l).setIsSortable(n).defineAsCheck(),Y=(t,l,n=!0)=>new B(t,l).setIsSortable(n).defineAsSwitch(),Z=(t,l,n,s=!0)=>new B(t,l).setIsSortable(s).defineAsSelect(n),v=(t,l,n=!0)=>new B(t,l).setIsSortable(n).setIsHidden(!0),j=(t,l,n,s)=>{if(!n)return 0;let d=t[n.key],o=l[n.key];if(s==="asc"){if(d>o)return 1;if(o>d)return-1}else{if(d>o)return-1;if(o>d)return 1}return 0},E=(t,l,n)=>t.formatter&&typeof t.formatter=="function"?t.formatter(l[t.key],l,t,n):l[t.key],_=(t,l,n)=>{if(!t.colspan)return-1;let s=l;return n.forEach(d=>{let o=L(t,d);o>0&&o<s&&(s=o)}),s},L=(t,l)=>t.colspan===!1?!1:typeof t.colspan=="function"?t.colspan(l):t.colspan,ee=(t,l,n)=>{if(typeof t!="object"||!t.key||l.indexOf(t.key)>-1)return!1;let s=L(t,n);return typeof t.colspan>"u"?!0:(typeof t.colspan<"u"&&(typeof t.colspan=="function"?s=parseInt(t.colspan()):s=parseInt(t.colspan)),s>0)},te=(t=[])=>{if(t.length>0){for(let l=0;l<t.length;++l)if(t[l].sortable)return t[l].key}return""},le=(t,l)=>{if(t.length>0){for(let n=0;n<t.length;++n)if(t[n].key===l)return t[n]}return null},ne={name:"LktTableCell",inheritAttrs:!1},K=e.defineComponent({...ne,props:{column:{type:Object,default:()=>({})},i:{type:[Number],default:0},modelValue:{type:Object,default:()=>({})}},emits:["edited"],setup(t,{emit:l}){const n=l,s=t,d=e.ref(s.modelValue),o=e.ref(d.value[s.column.key]),y=e.ref(null);return e.watch(o,()=>{const b=JSON.parse(JSON.stringify(d.value));b[s.column.key]=o.value,n("edited",b,s.i)}),e.watch(()=>s.modelValue,b=>{d.value=b,o.value=d.value[s.column.key]}),(b,a)=>{const k=e.resolveComponent("router-link"),i=e.resolveComponent("lkt-field-text"),V=e.resolveComponent("lkt-field-check"),N=e.resolveComponent("lkt-field-switch"),w=e.resolveComponent("lkt-field-select");return t.column.type==="link"?(e.openBlock(),e.createBlock(k,{key:0,to:t.column.getHref(d.value)},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(E)(t.column,d.value,t.i)),1)]),_:1},8,["to"])):t.column.type==="action"?(e.openBlock(),e.createElementBlock("a",{key:1,href:"#",onClick:a[0]||(a[0]=f=>t.column.doAction(d.value))},e.toDisplayString(e.unref(E)(t.column,d.value,t.i)),1)):t.column.type==="text"?(e.openBlock(),e.createBlock(i,{key:2,"read-mode":!t.column.editable,ref:f=>y.value=f,modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=f=>o.value=f)},null,8,["read-mode","modelValue"])):t.column.type==="email"?(e.openBlock(),e.createBlock(i,{key:3,"read-mode":!t.column.editable,ref:f=>y.value=f,"is-email":"",modelValue:o.value,"onUpdate:modelValue":a[2]||(a[2]=f=>o.value=f)},null,8,["read-mode","modelValue"])):t.column.type==="tel"?(e.openBlock(),e.createBlock(i,{key:4,"read-mode":!t.column.editable,ref:f=>y.value=f,"is-tel":"",modelValue:o.value,"onUpdate:modelValue":a[3]||(a[3]=f=>o.value=f)},null,8,["read-mode","modelValue"])):t.column.type==="check"?(e.openBlock(),e.createBlock(V,{key:5,"read-mode":!t.column.editable,ref:f=>y.value=f,modelValue:o.value,"onUpdate:modelValue":a[4]||(a[4]=f=>o.value=f)},null,8,["read-mode","modelValue"])):t.column.type==="switch"?(e.openBlock(),e.createBlock(N,{key:6,"read-mode":!t.column.editable,ref:f=>y.value=f,modelValue:o.value,"onUpdate:modelValue":a[5]||(a[5]=f=>o.value=f)},null,8,["read-mode","modelValue"])):t.column.type==="select"?(e.openBlock(),e.createBlock(w,{key:7,"read-mode":!t.column.editable,ref:f=>y.value=f,modelValue:o.value,"onUpdate:modelValue":a[6]||(a[6]=f=>o.value=f),options:t.column.options},null,8,["read-mode","modelValue","options"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:8},[e.createTextVNode(e.toDisplayString(e.unref(E)(t.column,d.value,t.i)),1)],64))}}}),ae=["data-i","data-handle-drag"],oe={key:0,"data-role":"drag-indicator"},re={key:1,"data-role":"invalid-drag-indicator"},ie=["data-column","colspan","title","onClick"],de={name:"LktTableRow",inheritAttrs:!1},q=e.defineComponent({...de,props:{isDraggable:{type:Boolean,default:!0},sortable:{type:Boolean,default:!0},i:{type:[Number],default:0},displayHiddenColumnsIndicator:{type:Boolean,default:!1},visibleColumns:{type:Array,default:()=>[]},emptyColumns:{type:Array,default:()=>[]},hiddenIsVisible:{type:Boolean,default:!1},item:{type:Object,default:()=>({})}},emits:["edited","click","show"],setup(t,{emit:l}){const n=l,s=t,d=e.ref(s.item),o=(a,k,i)=>{n("click",a,$.createLktEvent("",{item:k,column:i}))},y=(a,k)=>{n("show",a,$.createLktEvent("",{i:k}))},b=(a,k)=>{d.value=a};return e.watch(()=>s.item,a=>d.value=a),e.watch(d,()=>n("edited",d.value,s.i)),(a,k)=>(e.openBlock(),e.createElementBlock("tr",{"data-i":t.i,"data-handle-drag":t.isDraggable},[t.sortable&&t.isDraggable?(e.openBlock(),e.createElementBlock("td",oe)):t.sortable?(e.openBlock(),e.createElementBlock("td",re)):e.createCommentVNode("",!0),t.displayHiddenColumnsIndicator?(e.openBlock(),e.createElementBlock("td",{key:2,onClick:k[0]||(k[0]=i=>y(i,t.i)),"data-role":"show-more",class:e.normalizeClass(t.hiddenIsVisible?"state-open":"")},null,2)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.visibleColumns,i=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.unref(ee)(i,t.emptyColumns,t.item)?(e.openBlock(),e.createElementBlock("td",{key:0,"data-column":i.key,colspan:e.unref(L)(i,t.item),title:e.unref(E)(i,t.item,t.i),onClick:V=>o(V,t.item,i)},[a.$slots[i.key]?e.renderSlot(a.$slots,i.key,{key:0,value:t.item[i.key],item:t.item,column:i,i:t.i}):t.item?(e.openBlock(),e.createBlock(K,{key:1,column:i,modelValue:d.value,"onUpdate:modelValue":k[1]||(k[1]=V=>d.value=V),i:t.i,onEdited:b},null,8,["column","modelValue","i"])):e.createCommentVNode("",!0)],8,ie)):e.createCommentVNode("",!0)],64))),256))],8,ae))}}),se={"data-role":"hidden-row"},ce=["colspan"],me=["data-column"],ue=["data-i"],fe=["data-column","title","onClick"],ke={name:"LktHiddenRow",inheritAttrs:!1},ye=e.defineComponent({...ke,props:{isDraggable:{type:Boolean,default:!0},sortable:{type:Boolean,default:!0},i:{type:[Number],default:0},hiddenColumnsColSpan:{type:Number,default:0},visibleColumns:{type:Array,default:()=>[]},hiddenColumns:{type:Array,default:()=>[]},emptyColumns:{type:Array,default:()=>[]},hiddenIsVisible:{type:Boolean,default:!1},modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","click"],setup(t,{emit:l}){const n=l,s=t,d=e.ref(s.modelValue),o=(y,b,a)=>{n("click",y,$.createLktEvent("",{item:b,column:a}))};return e.watch(()=>s.modelValue,y=>d.value=y),e.watch(d,()=>n("update:modelValue",d.value)),(y,b)=>e.withDirectives((e.openBlock(),e.createElementBlock("tr",se,[e.createElementVNode("td",{colspan:t.hiddenColumnsColSpan},[e.createElementVNode("table",null,[e.createElementVNode("tr",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.hiddenColumns,a=>(e.openBlock(),e.createElementBlock("th",{"data-column":a.key},[e.createElementVNode("div",null,e.toDisplayString(a.label),1)],8,me))),256))]),e.createElementVNode("tr",{"data-i":t.i},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.hiddenColumns,(a,k)=>(e.openBlock(),e.createElementBlock("td",{"data-column":a.key,title:e.unref(E)(a,d.value,k),onClick:i=>o(i,d.value,a)},[y.$slots[a.key]?e.renderSlot(y.$slots,a.key,{key:0,value:d.value[a.key],item:d.value,column:a,i:k}):(e.openBlock(),e.createBlock(K,{key:1,column:a,modelValue:d.value,"onUpdate:modelValue":b[0]||(b[0]=i=>d.value=i),i:k},null,8,["column","modelValue","i"]))],8,fe))),256))],8,ue)])],8,ce)],512)),[[e.vShow,t.hiddenIsVisible]])}}),he=["data-sortable"],be={key:0,"data-role":"drag-indicator"},pe={key:1},Ce=["data-column","data-sortable","data-sort","colspan","title","onClick"],ge={key:1},Be={key:1,class:"lkt-empty-table"},Ve={name:"LktTable",inheritAttrs:!1},Se=e.defineComponent({...Ve,props:{modelValue:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},sorter:{type:Function,default:j},sortable:{type:Boolean,default:!1},hideEmptyColumns:{type:Boolean,default:!1},draggableChecker:{type:Function,default:t=>!0},checkValidDrag:{type:Function,default:t=>!0},draggableItemKey:{type:String,default:"name"}},emits:["update:modelValue","sort","click"],setup(t,{expose:l,emit:n}){const s=n,d=e.useSlots(),o=t,y={},b=e.ref(typeof o.sorter=="function"?o.sorter:j),a=e.ref(te(o.columns)),k=e.ref("asc"),i=e.ref(o.modelValue),V=e.ref(y),N=e.ref(!1),w=R.generateRandomString(12),f=e.computed(()=>i.value.length>0),I=e.computed(()=>{if(!o.hideEmptyColumns)return[];let r=[];return o.columns.forEach(c=>{let m=c.key,h=!1;i.value.forEach(p=>{if(typeof p.checkEmpty=="function")return p.checkEmpty(p);p[m]&&(h=!0)}),h||r.push(m)}),r}),A=e.computed(()=>o.columns.filter(r=>!r.hidden)),T=e.computed(()=>o.columns.filter(r=>r.hidden)),we=e.computed(()=>{let r=A.value.length+1;return o.sortable&&++r,r}),D=e.computed(()=>T.value.length>0&&!o.sortable),Ae=e.computed(()=>o.columns.map(r=>r.key)),F=e.computed(()=>{let r=[];for(let c in d)Ae.value.indexOf(c)!==-1&&r.push(c);return r}),Ne=r=>{let c=r.target;if(typeof c.dataset.column>"u")do c=c.parentNode;while(typeof c.dataset.column>"u"&&c.tagName!=="TABLE"&&c.tagName!=="body");if(c.tagName==="TD"&&(c=c.parentNode,c=c.dataset.i,typeof c<"u"))return i.value[c]},H=r=>V.value["tr_"+r]===!0,x=r=>{!r||r.sortable&&(i.value=i.value.sort((c,m)=>b.value(c,m,r,k.value)),k.value=k.value==="asc"?"desc":"asc",a.value=r.key,s("sort",[a.value,k.value]))},O=(r,c)=>{s("click",r,c)},U=(r,c)=>{let m="tr_"+c.value.i;V.value[m]=typeof V.value[m]>"u"?!0:!V.value[m]},Ie=(r,c)=>{i.value[c]=r};return e.onMounted(()=>{x(le(o.columns,a.value))}),e.watch(()=>o.modelValue,r=>i.value=r),e.watch(i,r=>{s("update:modelValue",r)}),l({getItemByEvent:Ne}),(r,c)=>f.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"lkt-table","data-sortable":t.sortable},[e.createElementVNode("table",null,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t.sortable?(e.openBlock(),e.createElementBlock("th",be)):e.createCommentVNode("",!0),D.value?(e.openBlock(),e.createElementBlock("th",pe)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(A.value,m=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[I.value.indexOf(m.key)===-1?(e.openBlock(),e.createElementBlock("th",{key:0,"data-column":m.key,"data-sortable":m.sortable===!0,"data-sort":m.sortable===!0&&a.value===m.key?k.value:"",colspan:e.unref(_)(m,t.columns.length,i.value),title:m.label,onClick:h=>x(m)},[e.createElementVNode("div",null,e.toDisplayString(m.label),1)],8,Ce)):e.createCommentVNode("",!0)],64))),256))])]),t.sortable?(e.openBlock(),e.createBlock(e.unref(M.default),{key:0,modelValue:i.value,"onUpdate:modelValue":c[0]||(c[0]=m=>i.value=m),move:t.checkValidDrag,itemKey:t.draggableItemKey,onStart:c[1]||(c[1]=m=>N.value=!0),onEnd:c[2]||(c[2]=m=>N.value=!1),tag:"tbody",class:"lkt-sortable-table",handle:"[data-handle-drag]"},{item:e.withCtx(({element:m,index:h})=>[(e.openBlock(),e.createBlock(q,{key:e.unref(w)+"-"+h,i:h,item:m,"display-hidden-columns-indicator":D.value,"is-draggable":t.draggableChecker?t.draggableChecker(m):!0,sortable:t.sortable,"visible-columns":A.value,"empty-columns":I.value,"hidden-is-visible":H(h),onClick:O,onShow:U},e.createSlots({_:2},[e.renderList(F.value,p=>({name:p,fn:e.withCtx(g=>[e.renderSlot(r.$slots,p,{item:g.item,value:g.value,column:g.column})])}))]),1032,["i","item","display-hidden-columns-indicator","is-draggable","sortable","visible-columns","empty-columns","hidden-is-visible"]))]),_:3},8,["modelValue","move","itemKey"])):(e.openBlock(),e.createElementBlock("tbody",ge,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,(m,h)=>(e.openBlock(),e.createBlock(q,{key:e.unref(w)+"-"+h,i:h,item:m,"display-hidden-columns-indicator":D.value,"is-draggable":t.draggableChecker?t.draggableChecker(m):!0,sortable:t.sortable,"visible-columns":A.value,"empty-columns":I.value,"hidden-is-visible":H(h),onClick:O,onShow:U,onEdited:Ie},e.createSlots({_:2},[e.renderList(F.value,p=>({name:p,fn:e.withCtx(g=>[e.renderSlot(r.$slots,p,{item:g.item,value:g.value,column:g.column})])}))]),1032,["i","item","display-hidden-columns-indicator","is-draggable","sortable","visible-columns","empty-columns","hidden-is-visible"]))),128)),T.value.length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(i.value,(m,h)=>(e.openBlock(),e.createBlock(ye,{key:e.unref(w)+"-"+h,i:h,item:m,"hidden-columns":T.value,"hidden-columns-col-span":we.value,"is-draggable":t.draggableChecker?t.draggableChecker(m):!0,sortable:t.sortable,"visible-columns":A.value,"empty-columns":I.value,"hidden-is-visible":H(h),onClick:O,onShow:U},e.createSlots({_:2},[e.renderList(F.value,p=>({name:p,fn:e.withCtx(g=>[e.renderSlot(r.$slots,p,{item:g.item,value:g.value,column:g.column})])}))]),1032,["i","item","hidden-columns","hidden-columns-col-span","is-draggable","sortable","visible-columns","empty-columns","hidden-is-visible"]))),128)):e.createCommentVNode("",!0)]))])],8,he)):r.$slots["no-items"]?(e.openBlock(),e.createElementBlock("div",Be,[e.renderSlot(r.$slots,"no-items")])):e.createCommentVNode("",!0)}}),Ee={install:t=>{t.component("lkt-table",Se)}};u.createActionColumn=P,u.createCheckColumn=X,u.createColumn=z,u.createEmailColumn=Q,u.createHiddenColumn=v,u.createLinkColumn=J,u.createSelectColumn=Z,u.createSwitchColumn=Y,u.createTelColumn=W,u.createTextColumn=G,u.default=Ee,Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
