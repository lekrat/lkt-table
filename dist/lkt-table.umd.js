(function(u,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("vuedraggable"),require("lkt-events"),require("lkt-string-tools")):typeof define=="function"&&define.amd?define(["exports","vue","vuedraggable","lkt-events","lkt-string-tools"],e):(u=typeof globalThis<"u"?globalThis:u||self,e(u.LktTable={},u.Vue,u.draggable,u.LktEvents,u.LktStringTools))})(this,function(u,e,S,I,R){"use strict";var De=Object.defineProperty;var Te=(u,e,S)=>e in u?De(u,e,{enumerable:!0,configurable:!0,writable:!0,value:S}):u[e]=S;var b=(u,e,S)=>(Te(u,typeof e!="symbol"?e+"":e,S),S);const M=(t=>t&&typeof t=="object"&&"default"in t?t:{default:t})(S);class E{constructor(l="",n=""){b(this,"key");b(this,"label");b(this,"sortable");b(this,"hidden");b(this,"editable");b(this,"formatter");b(this,"checkEmpty");b(this,"colspan");b(this,"type");b(this,"link");b(this,"action");b(this,"options");this.key=l,this.label=n,this.sortable=!0,this.hidden=!1,this.formatter=void 0,this.checkEmpty=void 0,this.colspan=void 0}setIsSortable(l=!0){return this.sortable=l,this}setIsEditable(l=!0){return this.editable=l,this}setIsHidden(l=!0){return this.hidden=l,this}setFormatter(l=void 0){return this.formatter=l,this}setEmptyChecker(l=void 0){return this.checkEmpty=l,this}setColSpan(l=void 0){return this.colspan=void 0,this}getHref(l){return typeof this.link=="function"?this.link(l):this.link}doAction(l){if(typeof this.action=="function")return this.action(l);console.warn("No action defined")}defineAsLink(l){return this.type="link",this.link=l,this}defineAsText(){return this.type="text",this}defineAsInt(){return this.type="int",this}defineAsFloat(){return this.type="float",this}defineAsCheck(){return this.type="check",this}defineAsSwitch(){return this.type="switch",this}defineAsAction(l){return this.type="action",this.action=l,this}defineAsSelect(l){return this.type="select",this.options=l,this}}const z=(t,l,n=!0)=>new E(t,l).setIsSortable(n),J=(t,l,n,d=!0)=>new E(t,l).setIsSortable(d).defineAsLink(n),P=(t,l,n,d=!0)=>new E(t,l).setIsSortable(d).defineAsAction(n),G=(t,l,n=!0)=>new E(t,l).setIsSortable(n).defineAsText(),Q=(t,l,n=!0)=>new E(t,l).setIsSortable(n).defineAsCheck(),W=(t,l,n=!0)=>new E(t,l).setIsSortable(n).defineAsSwitch(),X=(t,l,n,d=!0)=>new E(t,l).setIsSortable(d).defineAsSelect(n),Y=(t,l,n=!0)=>new E(t,l).setIsSortable(n).setIsHidden(!0),j=(t,l,n,d)=>{if(!n)return 0;let o=t[n.key],r=l[n.key];if(d==="asc"){if(o>r)return 1;if(r>o)return-1}else{if(o>r)return-1;if(r>o)return 1}return 0},V=(t,l,n)=>t.formatter&&typeof t.formatter=="function"?t.formatter(l[t.key],l,t,n):l[t.key],Z=(t,l,n)=>{if(!t.colspan)return-1;let d=l;return n.forEach(o=>{let r=L(t,o);r>0&&r<d&&(d=r)}),d},L=(t,l)=>t.colspan===!1?!1:typeof t.colspan=="function"?t.colspan(l):t.colspan,_=(t,l,n)=>{if(typeof t!="object"||!t.key||l.indexOf(t.key)>-1)return!1;let d=L(t,n);return typeof t.colspan>"u"?!0:(typeof t.colspan<"u"&&(typeof t.colspan=="function"?d=parseInt(t.colspan()):d=parseInt(t.colspan)),d>0)},v=(t=[])=>{if(t.length>0){for(let l=0;l<t.length;++l)if(t[l].sortable)return t[l].key}return""},ee=(t,l)=>{if(t.length>0){for(let n=0;n<t.length;++n)if(t[n].key===l)return t[n]}return null},te=e.createElementVNode("i",{class:"lkt-cell-text"},null,-1),le=e.createElementVNode("i",{class:"lkt-cell-check"},null,-1),ne=e.createElementVNode("i",{class:"lkt-cell-check"},null,-1),ae=e.createElementVNode("i",{class:"lkt-cell-check"},null,-1),oe={name:"LktTableCell",inheritAttrs:!1},U=e.defineComponent({...oe,props:{column:{type:Object,default:()=>({})},i:{type:[Number],default:0},modelValue:{type:Object,default:()=>({})}},emits:["edited"],setup(t,{emit:l}){const n=l,d=t,o=e.ref(d.modelValue),r=e.ref(o.value[d.column.key]),g=e.ref(null);return e.watch(r,()=>{const y=JSON.parse(JSON.stringify(o.value));y[d.column.key]=r.value,n("edited",y,d.i)}),e.watch(()=>d.modelValue,y=>{o.value=y,r.value=o.value[d.column.key]}),(y,a)=>{const k=e.resolveComponent("router-link"),c=e.resolveComponent("lkt-field-text"),p=e.resolveComponent("lkt-field-check"),A=e.resolveComponent("lkt-field-switch"),N=e.resolveComponent("lkt-field-select");return t.column.type==="link"?(e.openBlock(),e.createBlock(k,{key:0,to:t.column.getHref(o.value)},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(V)(t.column,o.value,t.i)),1)]),_:1},8,["to"])):t.column.type==="action"?(e.openBlock(),e.createElementBlock("a",{key:1,href:"#",onClick:a[0]||(a[0]=C=>t.column.doAction(o.value))},e.toDisplayString(e.unref(V)(t.column,o.value,t.i)),1)):t.column.type==="text"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[t.column.editable?(e.openBlock(),e.createBlock(c,{key:0,ref:C=>g.value=C,modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=C=>r.value=C)},null,8,["modelValue"])):e.createCommentVNode("",!0),t.column.editable?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[te,e.createTextVNode(e.toDisplayString(e.unref(V)(t.column,o.value,t.i)),1)],64))],64)):t.column.type==="check"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:3},[t.column.editable?(e.openBlock(),e.createBlock(p,{key:0,modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=C=>r.value=C)},null,8,["modelValue"])):e.createCommentVNode("",!0),t.column.editable?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[le,e.createTextVNode(e.toDisplayString(e.unref(V)(t.column,o.value,t.i)),1)],64))],64)):t.column.type==="switch"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:4},[t.column.editable?(e.openBlock(),e.createBlock(A,{key:0,modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=C=>r.value=C)},null,8,["modelValue"])):e.createCommentVNode("",!0),t.column.editable?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[ne,e.createTextVNode(e.toDisplayString(e.unref(V)(t.column,o.value,t.i)),1)],64))],64)):t.column.type==="select"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:5},[t.column.editable?(e.openBlock(),e.createBlock(N,{key:0,modelValue:r.value,"onUpdate:modelValue":a[4]||(a[4]=C=>r.value=C),options:t.column.options},null,8,["modelValue","options"])):e.createCommentVNode("",!0),t.column.editable?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[ae,e.createTextVNode(e.toDisplayString(e.unref(V)(t.column,o.value,t.i)),1)],64))],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:6},[e.createTextVNode(e.toDisplayString(e.unref(V)(t.column,o.value,t.i)),1)],64))}}}),re=["data-i","data-handle-drag"],ie={key:0,"data-role":"drag-indicator"},ce={key:1,"data-role":"invalid-drag-indicator"},de=["data-column","colspan","title","onClick"],se={name:"LktTableRow",inheritAttrs:!1},K=e.defineComponent({...se,props:{isDraggable:{type:Boolean,default:!0},sortable:{type:Boolean,default:!0},i:{type:[Number],default:0},displayHiddenColumnsIndicator:{type:Boolean,default:!1},visibleColumns:{type:Array,default:()=>[]},emptyColumns:{type:Array,default:()=>[]},hiddenIsVisible:{type:Boolean,default:!1},item:{type:Object,default:()=>({})}},emits:["edited","click","show"],setup(t,{emit:l}){const n=l,d=t,o=e.ref(d.item),r=(a,k,c)=>{n("click",a,I.createLktEvent("",{item:k,column:c}))},g=(a,k)=>{n("show",a,I.createLktEvent("",{i:k}))},y=(a,k)=>{o.value=a};return e.watch(()=>d.item,a=>o.value=a),e.watch(o,()=>n("edited",o.value,d.i)),(a,k)=>(e.openBlock(),e.createElementBlock("tr",{"data-i":t.i,"data-handle-drag":t.isDraggable},[t.sortable&&t.isDraggable?(e.openBlock(),e.createElementBlock("td",ie)):t.sortable?(e.openBlock(),e.createElementBlock("td",ce)):e.createCommentVNode("",!0),t.displayHiddenColumnsIndicator?(e.openBlock(),e.createElementBlock("td",{key:2,onClick:k[0]||(k[0]=c=>g(c,t.i)),"data-role":"show-more",class:e.normalizeClass(t.hiddenIsVisible?"state-open":"")},null,2)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.visibleColumns,c=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.unref(_)(c,t.emptyColumns,t.item)?(e.openBlock(),e.createElementBlock("td",{key:0,"data-column":c.key,colspan:e.unref(L)(c,t.item),title:e.unref(V)(c,t.item,t.i),onClick:p=>r(p,t.item,c)},[a.$slots[c.key]?e.renderSlot(a.$slots,c.key,{key:0,value:t.item[c.key],item:t.item,column:c,i:t.i}):t.item?(e.openBlock(),e.createBlock(U,{key:1,column:c,modelValue:o.value,"onUpdate:modelValue":k[1]||(k[1]=p=>o.value=p),i:t.i,onEdited:y},null,8,["column","modelValue","i"])):e.createCommentVNode("",!0)],8,de)):e.createCommentVNode("",!0)],64))),256))],8,re))}}),me={"data-role":"hidden-row"},ue=["colspan"],ke=["data-column"],fe=["data-i"],ye=["data-column","title","onClick"],he={name:"LktHiddenRow",inheritAttrs:!1},be=e.defineComponent({...he,props:{isDraggable:{type:Boolean,default:!0},sortable:{type:Boolean,default:!0},i:{type:[Number],default:0},hiddenColumnsColSpan:{type:Number,default:0},visibleColumns:{type:Array,default:()=>[]},hiddenColumns:{type:Array,default:()=>[]},emptyColumns:{type:Array,default:()=>[]},hiddenIsVisible:{type:Boolean,default:!1},modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","click"],setup(t,{emit:l}){const n=l,d=t,o=e.ref(d.modelValue),r=(g,y,a)=>{n("click",g,I.createLktEvent("",{item:y,column:a}))};return e.watch(()=>d.modelValue,g=>o.value=g),e.watch(o,()=>n("update:modelValue",o.value)),(g,y)=>e.withDirectives((e.openBlock(),e.createElementBlock("tr",me,[e.createElementVNode("td",{colspan:t.hiddenColumnsColSpan},[e.createElementVNode("table",null,[e.createElementVNode("tr",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.hiddenColumns,a=>(e.openBlock(),e.createElementBlock("th",{"data-column":a.key},[e.createElementVNode("div",null,e.toDisplayString(a.label),1)],8,ke))),256))]),e.createElementVNode("tr",{"data-i":t.i},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.hiddenColumns,(a,k)=>(e.openBlock(),e.createElementBlock("td",{"data-column":a.key,title:e.unref(V)(a,o.value,k),onClick:c=>r(c,o.value,a)},[g.$slots[a.key]?e.renderSlot(g.$slots,a.key,{key:0,value:o.value[a.key],item:o.value,column:a,i:k}):(e.openBlock(),e.createBlock(U,{key:1,column:a,modelValue:o.value,"onUpdate:modelValue":y[0]||(y[0]=c=>o.value=c),i:k},null,8,["column","modelValue","i"]))],8,ye))),256))],8,fe)])],8,ue)],512)),[[e.vShow,t.hiddenIsVisible]])}}),ge=["data-sortable"],Ce={key:0,"data-role":"drag-indicator"},Be={key:1},pe=["data-column","data-sortable","data-sort","colspan","title","onClick"],Ve={key:1},Ee={key:1,class:"lkt-empty-table"},Se={name:"LktTable",inheritAttrs:!1},Ne=e.defineComponent({...Se,props:{modelValue:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},sorter:{type:Function,default:j},sortable:{type:Boolean,default:!1},hideEmptyColumns:{type:Boolean,default:!1},draggableChecker:{type:Function,default:t=>!0},checkValidDrag:{type:Function,default:t=>!0},draggableItemKey:{type:String,default:"name"}},emits:["update:modelValue","sort","click"],setup(t,{expose:l,emit:n}){const d=n,o=e.useSlots(),r=t,g={},y=e.ref(typeof r.sorter=="function"?r.sorter:j),a=e.ref(v(r.columns)),k=e.ref("asc"),c=e.ref(r.modelValue),p=e.ref(g),A=e.ref(!1),N=R.generateRandomString(12),C=e.computed(()=>c.value.length>0),$=e.computed(()=>{if(!r.hideEmptyColumns)return[];let i=[];return r.columns.forEach(s=>{let m=s.key,f=!1;c.value.forEach(h=>{if(typeof h.checkEmpty=="function")return h.checkEmpty(h);h[m]&&(f=!0)}),f||i.push(m)}),i}),w=e.computed(()=>r.columns.filter(i=>!i.hidden)),D=e.computed(()=>r.columns.filter(i=>i.hidden)),Ae=e.computed(()=>{let i=w.value.length+1;return r.sortable&&++i,i}),T=e.computed(()=>D.value.length>0&&!r.sortable),$e=e.computed(()=>r.columns.map(i=>i.key)),F=e.computed(()=>{let i=[];for(let s in o)$e.value.indexOf(s)!==-1&&i.push(s);return i}),Ie=i=>{let s=i.target;if(typeof s.dataset.column>"u")do s=s.parentNode;while(typeof s.dataset.column>"u"&&s.tagName!=="TABLE"&&s.tagName!=="body");if(s.tagName==="TD"&&(s=s.parentNode,s=s.dataset.i,typeof s<"u"))return c.value[s]},x=i=>p.value["tr_"+i]===!0,q=i=>{!i||i.sortable&&(c.value=c.value.sort((s,m)=>y.value(s,m,i,k.value)),k.value=k.value==="asc"?"desc":"asc",a.value=i.key,d("sort",[a.value,k.value]))},H=(i,s)=>{d("click",i,s)},O=(i,s)=>{let m="tr_"+s.value.i;p.value[m]=typeof p.value[m]>"u"?!0:!p.value[m]},Le=(i,s)=>{c.value[s]=i};return e.onMounted(()=>{q(ee(r.columns,a.value))}),e.watch(()=>r.modelValue,i=>c.value=i),e.watch(c,i=>{d("update:modelValue",i)}),l({getItemByEvent:Ie}),(i,s)=>C.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"lkt-table","data-sortable":t.sortable},[e.createElementVNode("table",null,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t.sortable?(e.openBlock(),e.createElementBlock("th",Ce)):e.createCommentVNode("",!0),T.value?(e.openBlock(),e.createElementBlock("th",Be)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.value,m=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[$.value.indexOf(m.key)===-1?(e.openBlock(),e.createElementBlock("th",{key:0,"data-column":m.key,"data-sortable":m.sortable===!0,"data-sort":m.sortable===!0&&a.value===m.key?k.value:"",colspan:e.unref(Z)(m,t.columns.length,c.value),title:m.label,onClick:f=>q(m)},[e.createElementVNode("div",null,e.toDisplayString(m.label),1)],8,pe)):e.createCommentVNode("",!0)],64))),256))])]),t.sortable?(e.openBlock(),e.createBlock(e.unref(M.default),{key:0,modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=m=>c.value=m),move:t.checkValidDrag,itemKey:t.draggableItemKey,onStart:s[1]||(s[1]=m=>A.value=!0),onEnd:s[2]||(s[2]=m=>A.value=!1),tag:"tbody",class:"lkt-sortable-table",handle:"[data-handle-drag]"},{item:e.withCtx(({element:m,index:f})=>[(e.openBlock(),e.createBlock(K,{key:e.unref(N)+"-"+f,i:f,item:m,"display-hidden-columns-indicator":T.value,"is-draggable":t.draggableChecker?t.draggableChecker(m):!0,sortable:t.sortable,"visible-columns":w.value,"empty-columns":$.value,"hidden-is-visible":x(f),onClick:H,onShow:O},e.createSlots({_:2},[e.renderList(F.value,h=>({name:h,fn:e.withCtx(B=>[e.renderSlot(i.$slots,h,{item:B.item,value:B.value,column:B.column})])}))]),1032,["i","item","display-hidden-columns-indicator","is-draggable","sortable","visible-columns","empty-columns","hidden-is-visible"]))]),_:3},8,["modelValue","move","itemKey"])):(e.openBlock(),e.createElementBlock("tbody",Ve,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,(m,f)=>(e.openBlock(),e.createBlock(K,{key:e.unref(N)+"-"+f,i:f,item:m,"display-hidden-columns-indicator":T.value,"is-draggable":t.draggableChecker?t.draggableChecker(m):!0,sortable:t.sortable,"visible-columns":w.value,"empty-columns":$.value,"hidden-is-visible":x(f),onClick:H,onShow:O,onEdited:Le},e.createSlots({_:2},[e.renderList(F.value,h=>({name:h,fn:e.withCtx(B=>[e.renderSlot(i.$slots,h,{item:B.item,value:B.value,column:B.column})])}))]),1032,["i","item","display-hidden-columns-indicator","is-draggable","sortable","visible-columns","empty-columns","hidden-is-visible"]))),128)),D.value.length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(c.value,(m,f)=>(e.openBlock(),e.createBlock(be,{key:e.unref(N)+"-"+f,i:f,item:m,"hidden-columns":D.value,"hidden-columns-col-span":Ae.value,"is-draggable":t.draggableChecker?t.draggableChecker(m):!0,sortable:t.sortable,"visible-columns":w.value,"empty-columns":$.value,"hidden-is-visible":x(f),onClick:H,onShow:O},e.createSlots({_:2},[e.renderList(F.value,h=>({name:h,fn:e.withCtx(B=>[e.renderSlot(i.$slots,h,{item:B.item,value:B.value,column:B.column})])}))]),1032,["i","item","hidden-columns","hidden-columns-col-span","is-draggable","sortable","visible-columns","empty-columns","hidden-is-visible"]))),128)):e.createCommentVNode("",!0)]))])],8,ge)):i.$slots["no-items"]?(e.openBlock(),e.createElementBlock("div",Ee,[e.renderSlot(i.$slots,"no-items")])):e.createCommentVNode("",!0)}}),we={install:t=>{t.component("lkt-table",Ne)}};u.createActionColumn=P,u.createCheckColumn=Q,u.createColumn=z,u.createHiddenColumn=Y,u.createLinkColumn=J,u.createSelectColumn=X,u.createSwitchColumn=W,u.createTextColumn=G,u.default=we,Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
