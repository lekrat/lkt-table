(function(k,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("vuedraggable"),require("lkt-http-client"),require("lkt-events"),require("lkt-string-tools")):typeof define=="function"&&define.amd?define(["exports","vue","vuedraggable","lkt-http-client","lkt-events","lkt-string-tools"],e):(k=typeof globalThis<"u"?globalThis:k||self,e(k.LktTable={},k.Vue,k.draggable,k.lktHttpClient,k.LktEvents,k.LktStringTools))})(this,function(k,e,S,x,I,K){"use strict";var $e=Object.defineProperty;var Te=(k,e,S)=>e in k?$e(k,e,{enumerable:!0,configurable:!0,writable:!0,value:S}):k[e]=S;var h=(k,e,S)=>(Te(k,typeof e!="symbol"?e+"":e,S),S);const z=(t=>t&&typeof t=="object"&&"default"in t?t:{default:t})(S);class V{constructor(l="",n=""){h(this,"key");h(this,"label");h(this,"sortable");h(this,"hidden");h(this,"editable");h(this,"formatter");h(this,"checkEmpty");h(this,"colspan");h(this,"type");h(this,"link");h(this,"action");h(this,"options");h(this,"resource");h(this,"resourceData");h(this,"isMultiple");h(this,"isLoading");h(this,"resourceLoaded");this.key=l,this.label=n,this.sortable=!0,this.hidden=!1,this.formatter=void 0,this.checkEmpty=void 0,this.colspan=void 0,this.resource="",this.resourceData={},this.isMultiple=!1,this.isLoading=!1,this.resourceLoaded=!1}setIsSortable(l=!0){return this.sortable=l,this}setIsEditable(l=!0){return this.editable=l,this}setIsHidden(l=!0){return this.hidden=l,this}setIsLoading(l=!0){return this.isLoading=l,this}setFormatter(l=void 0){return this.formatter=l,this}setEmptyChecker(l=void 0){return this.checkEmpty=l,this}setColSpan(l=void 0){return this.colspan=void 0,this}getHref(l){return typeof this.link=="function"?this.link(l):this.link}doAction(l){if(typeof this.action=="function")return this.action(l);console.warn("No action defined")}defineAsLink(l){return this.type="link",this.link=l,this}defineAsText(){return this.type="text",this}defineAsEmail(){return this.type="email",this}defineAsTel(){return this.type="tel",this}defineAsInt(){return this.type="int",this}defineAsFloat(){return this.type="float",this}defineAsCheck(){return this.type="check",this}defineAsSwitch(){return this.type="switch",this}defineAsAction(l){return this.type="action",this.action=l,this}defineAsSelect(l){return this.type="select",this.options=l,this}showLoading(){return this.resource!==""&&!this.resourceLoaded}hasToLoadResource(){return this.resource!==""&&!this.resourceLoaded&&!this.isLoading}setIsMultiple(l=!0){return this.isMultiple=l,this}setResource(l){return this.resource=l,this}setResourceData(l){return this.resourceData=l,this}async loadResource(){if(this.resourceLoaded)return this;if(!this.resource)return this;try{this.isLoading=!0;const l=await x.httpCall(this.resource,this.resourceData);this.options=l.data,this.isLoading=!1,this.resourceLoaded=!0}catch{this.isLoading=!1}return this}}const J=(t,l,n=!0)=>e.reactive(new V(t,l).setIsSortable(n)),P=(t,l,n,o=!0)=>e.reactive(new V(t,l).setIsSortable(o).defineAsLink(n)),G=(t,l,n,o=!0)=>e.reactive(new V(t,l).setIsSortable(o).defineAsAction(n)),Q=(t,l,n=!0)=>e.reactive(new V(t,l).setIsSortable(n).defineAsText()),W=(t,l,n=!0)=>e.reactive(new V(t,l).setIsSortable(n).defineAsEmail()),X=(t,l,n=!0)=>e.reactive(new V(t,l).setIsSortable(n).defineAsTel()),Y=(t,l,n=!0)=>e.reactive(new V(t,l).setIsSortable(n).defineAsCheck()),Z=(t,l,n=!0)=>e.reactive(new V(t,l).setIsSortable(n).defineAsSwitch()),v=(t,l,n,o=!0)=>e.reactive(new V(t,l).setIsSortable(o).defineAsSelect(n)),_=(t,l,n=!0)=>e.reactive(new V(t,l).setIsSortable(n).setIsHidden(!0)),U=(t,l,n,o)=>{if(!n)return 0;let i=t[n.key],a=l[n.key];if(o==="asc"){if(i>a)return 1;if(a>i)return-1}else{if(i>a)return-1;if(a>i)return 1}return 0},L=(t,l,n)=>t.formatter&&typeof t.formatter=="function"?t.formatter(l[t.key],l,t,n):l[t.key],ee=(t,l,n)=>{if(!t.colspan)return-1;let o=l;return n.forEach(i=>{let a=N(t,i);a>0&&a<o&&(o=a)}),o},N=(t,l)=>t.colspan===!1?!1:typeof t.colspan=="function"?t.colspan(l):t.colspan,te=(t,l,n)=>{if(typeof t!="object"||!t.key||l.indexOf(t.key)>-1)return!1;let o=N(t,n);return typeof t.colspan>"u"?!0:(typeof t.colspan<"u"&&(typeof t.colspan=="function"?o=parseInt(t.colspan()):o=parseInt(t.colspan)),o>0)},le=(t=[])=>{if(t.length>0){for(let l=0;l<t.length;++l)if(t[l].sortable)return t[l].key}return""},ne=(t,l)=>{if(t.length>0){for(let n=0;n<t.length;++n)if(t[n].key===l)return t[n]}return null},ae={name:"LktTableCell",inheritAttrs:!1},j=e.defineComponent({...ae,props:{modelValue:{type:Object,default:()=>({})},column:{type:Object,default:()=>({})},i:{type:[Number],default:0}},emits:["edited"],setup(t,{emit:l}){const n=l,o=t,i=e.ref(o.modelValue),a=e.ref(i.value[o.column.key]),y=e.ref(null),C=e.ref(o.column.showLoading());return e.watch(a,()=>{const s=JSON.parse(JSON.stringify(i.value));s[o.column.key]=a.value,n("edited",s,o.i)}),e.watch(()=>o.modelValue,s=>{i.value=s,a.value=i.value[o.column.key]}),e.watch(()=>o.column,()=>{o.column.resourceLoaded&&e.nextTick(()=>C.value=!1)},{deep:!0}),o.column.hasToLoadResource()&&o.column.loadResource(),(s,d)=>{const c=e.resolveComponent("router-link"),g=e.resolveComponent("lkt-field-text"),A=e.resolveComponent("lkt-field-check"),w=e.resolveComponent("lkt-field-switch"),$=e.resolveComponent("lkt-loader"),E=e.resolveComponent("lkt-field-select");return t.column.type==="link"?(e.openBlock(),e.createBlock(c,{key:0,to:t.column.getHref(i.value)},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(L)(t.column,i.value,t.i)),1)]),_:1},8,["to"])):t.column.type==="action"?(e.openBlock(),e.createElementBlock("a",{key:1,href:"#",onClick:d[0]||(d[0]=f=>t.column.doAction(i.value))},e.toDisplayString(e.unref(L)(t.column,i.value,t.i)),1)):t.column.type==="text"?(e.openBlock(),e.createBlock(g,{key:2,"read-mode":!t.column.editable,ref:f=>y.value=f,modelValue:a.value,"onUpdate:modelValue":d[1]||(d[1]=f=>a.value=f)},null,8,["read-mode","modelValue"])):t.column.type==="email"?(e.openBlock(),e.createBlock(g,{key:3,"read-mode":!t.column.editable,ref:f=>y.value=f,"is-email":"",modelValue:a.value,"onUpdate:modelValue":d[2]||(d[2]=f=>a.value=f)},null,8,["read-mode","modelValue"])):t.column.type==="tel"?(e.openBlock(),e.createBlock(g,{key:4,"read-mode":!t.column.editable,ref:f=>y.value=f,"is-tel":"",modelValue:a.value,"onUpdate:modelValue":d[3]||(d[3]=f=>a.value=f)},null,8,["read-mode","modelValue"])):t.column.type==="check"?(e.openBlock(),e.createBlock(A,{key:5,"read-mode":!t.column.editable,ref:f=>y.value=f,modelValue:a.value,"onUpdate:modelValue":d[4]||(d[4]=f=>a.value=f)},null,8,["read-mode","modelValue"])):t.column.type==="switch"?(e.openBlock(),e.createBlock(w,{key:6,"read-mode":!t.column.editable,ref:f=>y.value=f,modelValue:a.value,"onUpdate:modelValue":d[5]||(d[5]=f=>a.value=f)},null,8,["read-mode","modelValue"])):t.column.type==="select"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:7},[C.value?(e.openBlock(),e.createBlock($,{key:0})):(e.openBlock(),e.createBlock(E,{key:1,"read-mode":!t.column.editable,ref:f=>y.value=f,modelValue:a.value,"onUpdate:modelValue":d[6]||(d[6]=f=>a.value=f),resource:t.column.resource,"resource-data":t.column.resourceData,options:t.column.options,multiple:t.column.isMultiple},null,8,["read-mode","modelValue","resource","resource-data","options","multiple"]))],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:8},[e.createTextVNode(e.toDisplayString(e.unref(L)(t.column,i.value,t.i)),1)],64))}}}),oe=["data-i","data-handle-drag"],re={key:0,"data-role":"drag-indicator"},ie={key:1,"data-role":"invalid-drag-indicator"},se=["data-column","colspan","title","onClick"],de={name:"LktTableRow",inheritAttrs:!1},M=e.defineComponent({...de,props:{isDraggable:{type:Boolean,default:!0},sortable:{type:Boolean,default:!0},i:{type:[Number],default:0},displayHiddenColumnsIndicator:{type:Boolean,default:!1},visibleColumns:{type:Array,default:()=>[]},emptyColumns:{type:Array,default:()=>[]},hiddenIsVisible:{type:Boolean,default:!1},item:{type:Object,default:()=>({})}},emits:["edited","click","show"],setup(t,{emit:l}){const n=l,o=t,i=e.ref(o.item),a=(s,d,c)=>{n("click",s,I.createLktEvent("",{item:d,column:c}))},y=(s,d)=>{n("show",s,I.createLktEvent("",{i:d}))},C=(s,d)=>{i.value=s};return e.watch(()=>o.item,s=>i.value=s),e.watch(i,()=>n("edited",i.value,o.i)),(s,d)=>(e.openBlock(),e.createElementBlock("tr",{"data-i":t.i,"data-handle-drag":t.isDraggable},[t.sortable&&t.isDraggable?(e.openBlock(),e.createElementBlock("td",re)):t.sortable?(e.openBlock(),e.createElementBlock("td",ie)):e.createCommentVNode("",!0),t.displayHiddenColumnsIndicator?(e.openBlock(),e.createElementBlock("td",{key:2,onClick:d[0]||(d[0]=c=>y(c,t.i)),"data-role":"show-more",class:e.normalizeClass(t.hiddenIsVisible?"state-open":"")},null,2)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.visibleColumns,c=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.unref(te)(c,t.emptyColumns,t.item)?(e.openBlock(),e.createElementBlock("td",{key:0,"data-column":c.key,colspan:e.unref(N)(c,t.item),title:e.unref(L)(c,t.item,t.i),onClick:g=>a(g,t.item,c)},[s.$slots[c.key]?e.renderSlot(s.$slots,c.key,{key:0,value:t.item[c.key],item:t.item,column:c,i:t.i}):t.item?(e.openBlock(),e.createBlock(j,{key:1,column:c,modelValue:i.value,"onUpdate:modelValue":d[1]||(d[1]=g=>i.value=g),i:t.i,onEdited:C},null,8,["column","modelValue","i"])):e.createCommentVNode("",!0)],8,se)):e.createCommentVNode("",!0)],64))),256))],8,oe))}}),ce={"data-role":"hidden-row"},ue=["colspan"],me=["data-column"],fe=["data-i"],ke=["data-column","title","onClick"],he={name:"LktHiddenRow",inheritAttrs:!1},ye=e.defineComponent({...he,props:{isDraggable:{type:Boolean,default:!0},sortable:{type:Boolean,default:!0},i:{type:[Number],default:0},hiddenColumnsColSpan:{type:Number,default:0},visibleColumns:{type:Array,default:()=>[]},hiddenColumns:{type:Array,default:()=>[]},emptyColumns:{type:Array,default:()=>[]},hiddenIsVisible:{type:Boolean,default:!1},modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","click"],setup(t,{emit:l}){const n=l,o=t,i=e.ref(o.modelValue),a=(y,C,s)=>{n("click",y,I.createLktEvent("",{item:C,column:s}))};return e.watch(()=>o.modelValue,y=>i.value=y),e.watch(i,()=>n("update:modelValue",i.value)),(y,C)=>e.withDirectives((e.openBlock(),e.createElementBlock("tr",ce,[e.createElementVNode("td",{colspan:t.hiddenColumnsColSpan},[e.createElementVNode("table",null,[e.createElementVNode("tr",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.hiddenColumns,s=>(e.openBlock(),e.createElementBlock("th",{"data-column":s.key},[e.createElementVNode("div",null,e.toDisplayString(s.label),1)],8,me))),256))]),e.createElementVNode("tr",{"data-i":t.i},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.hiddenColumns,(s,d)=>(e.openBlock(),e.createElementBlock("td",{"data-column":s.key,title:e.unref(L)(s,i.value,d),onClick:c=>a(c,i.value,s)},[y.$slots[s.key]?e.renderSlot(y.$slots,s.key,{key:0,value:i.value[s.key],item:i.value,column:s,i:d}):(e.openBlock(),e.createBlock(j,{key:1,column:s,modelValue:i.value,"onUpdate:modelValue":C[0]||(C[0]=c=>i.value=c),i:d},null,8,["column","modelValue","i"]))],8,ke))),256))],8,fe)])],8,ue)],512)),[[e.vShow,t.hiddenIsVisible]])}}),be=["data-sortable"],pe={key:0,"data-role":"drag-indicator"},ge={key:1},Ce=["data-column","data-sortable","data-sort","colspan","title","onClick"],Be={key:1},Ve={key:1,class:"lkt-empty-table"},Se={name:"LktTable",inheritAttrs:!1},Ee=e.defineComponent({...Se,props:{modelValue:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},sorter:{type:Function,default:U},sortable:{type:Boolean,default:!1},hideEmptyColumns:{type:Boolean,default:!1},draggableChecker:{type:Function,default:t=>!0},checkValidDrag:{type:Function,default:t=>!0},draggableItemKey:{type:String,default:"name"}},emits:["update:modelValue","sort","click"],setup(t,{expose:l,emit:n}){const o=n,i=e.useSlots(),a=t,y={},C=e.ref(typeof a.sorter=="function"?a.sorter:U),s=e.ref(le(a.columns)),d=e.ref("asc"),c=e.ref(a.modelValue),g=e.ref(y),A=e.ref(!1),w=K.generateRandomString(12),$=e.computed(()=>c.value.length>0),E=e.computed(()=>{if(!a.hideEmptyColumns)return[];let r=[];return a.columns.forEach(u=>{let m=u.key,b=!1;c.value.forEach(p=>{if(typeof p.checkEmpty=="function")return p.checkEmpty(p);p[m]&&(b=!0)}),b||r.push(m)}),r}),f=e.computed(()=>a.columns.filter(r=>!r.hidden)),T=e.computed(()=>a.columns.filter(r=>r.hidden)),we=e.computed(()=>{let r=f.value.length+1;return a.sortable&&++r,r}),D=e.computed(()=>T.value.length>0&&!a.sortable),Ae=e.computed(()=>a.columns.map(r=>r.key)),F=e.computed(()=>{let r=[];for(let u in i)Ae.value.indexOf(u)!==-1&&r.push(u);return r}),Ie=r=>{let u=r.target;if(typeof u.dataset.column>"u")do u=u.parentNode;while(typeof u.dataset.column>"u"&&u.tagName!=="TABLE"&&u.tagName!=="body");if(u.tagName==="TD"&&(u=u.parentNode,u=u.dataset.i,typeof u<"u"))return c.value[u]},H=r=>g.value["tr_"+r]===!0,q=r=>{!r||r.sortable&&(c.value=c.value.sort((u,m)=>C.value(u,m,r,d.value)),d.value=d.value==="asc"?"desc":"asc",s.value=r.key,o("sort",[s.value,d.value]))},O=(r,u)=>{o("click",r,u)},R=(r,u)=>{let m="tr_"+u.value.i;g.value[m]=typeof g.value[m]>"u"?!0:!g.value[m]},Ne=(r,u)=>{c.value[u]=r};return e.onMounted(()=>{q(ne(a.columns,s.value))}),e.watch(()=>a.modelValue,r=>c.value=r),e.watch(c,r=>{o("update:modelValue",r)}),l({getItemByEvent:Ie}),(r,u)=>$.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"lkt-table","data-sortable":t.sortable},[e.createElementVNode("table",null,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t.sortable?(e.openBlock(),e.createElementBlock("th",pe)):e.createCommentVNode("",!0),D.value?(e.openBlock(),e.createElementBlock("th",ge)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,m=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[E.value.indexOf(m.key)===-1?(e.openBlock(),e.createElementBlock("th",{key:0,"data-column":m.key,"data-sortable":m.sortable===!0,"data-sort":m.sortable===!0&&s.value===m.key?d.value:"",colspan:e.unref(ee)(m,t.columns.length,c.value),title:m.label,onClick:b=>q(m)},[e.createElementVNode("div",null,e.toDisplayString(m.label),1)],8,Ce)):e.createCommentVNode("",!0)],64))),256))])]),t.sortable?(e.openBlock(),e.createBlock(e.unref(z.default),{key:0,modelValue:c.value,"onUpdate:modelValue":u[0]||(u[0]=m=>c.value=m),move:t.checkValidDrag,itemKey:t.draggableItemKey,onStart:u[1]||(u[1]=m=>A.value=!0),onEnd:u[2]||(u[2]=m=>A.value=!1),tag:"tbody",class:"lkt-sortable-table",handle:"[data-handle-drag]"},{item:e.withCtx(({element:m,index:b})=>[(e.openBlock(),e.createBlock(M,{key:e.unref(w)+"-"+b,i:b,item:m,"display-hidden-columns-indicator":D.value,"is-draggable":t.draggableChecker?t.draggableChecker(m):!0,sortable:t.sortable,"visible-columns":f.value,"empty-columns":E.value,"hidden-is-visible":H(b),onClick:O,onShow:R},e.createSlots({_:2},[e.renderList(F.value,p=>({name:p,fn:e.withCtx(B=>[e.renderSlot(r.$slots,p,{item:B.item,value:B.value,column:B.column})])}))]),1032,["i","item","display-hidden-columns-indicator","is-draggable","sortable","visible-columns","empty-columns","hidden-is-visible"]))]),_:3},8,["modelValue","move","itemKey"])):(e.openBlock(),e.createElementBlock("tbody",Be,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,(m,b)=>(e.openBlock(),e.createBlock(M,{key:e.unref(w)+"-"+b,i:b,item:m,"display-hidden-columns-indicator":D.value,"is-draggable":t.draggableChecker?t.draggableChecker(m):!0,sortable:t.sortable,"visible-columns":f.value,"empty-columns":E.value,"hidden-is-visible":H(b),onClick:O,onShow:R,onEdited:Ne},e.createSlots({_:2},[e.renderList(F.value,p=>({name:p,fn:e.withCtx(B=>[e.renderSlot(r.$slots,p,{item:B.item,value:B.value,column:B.column})])}))]),1032,["i","item","display-hidden-columns-indicator","is-draggable","sortable","visible-columns","empty-columns","hidden-is-visible"]))),128)),T.value.length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(c.value,(m,b)=>(e.openBlock(),e.createBlock(ye,{key:e.unref(w)+"-"+b,i:b,item:m,"hidden-columns":T.value,"hidden-columns-col-span":we.value,"is-draggable":t.draggableChecker?t.draggableChecker(m):!0,sortable:t.sortable,"visible-columns":f.value,"empty-columns":E.value,"hidden-is-visible":H(b),onClick:O,onShow:R},e.createSlots({_:2},[e.renderList(F.value,p=>({name:p,fn:e.withCtx(B=>[e.renderSlot(r.$slots,p,{item:B.item,value:B.value,column:B.column})])}))]),1032,["i","item","hidden-columns","hidden-columns-col-span","is-draggable","sortable","visible-columns","empty-columns","hidden-is-visible"]))),128)):e.createCommentVNode("",!0)]))])],8,be)):r.$slots["no-items"]?(e.openBlock(),e.createElementBlock("div",Ve,[e.renderSlot(r.$slots,"no-items")])):e.createCommentVNode("",!0)}}),Le={install:t=>{t.component("lkt-table",Ee)}};k.createActionColumn=G,k.createCheckColumn=Y,k.createColumn=J,k.createEmailColumn=W,k.createHiddenColumn=_,k.createLinkColumn=P,k.createSelectColumn=v,k.createSwitchColumn=Z,k.createTelColumn=X,k.createTextColumn=Q,k.default=Le,Object.defineProperties(k,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
